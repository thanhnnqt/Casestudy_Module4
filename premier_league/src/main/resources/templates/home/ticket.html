<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ƒê·∫∑t v√© - V.League</title>

    <!-- 1. CSS Variables -->
    <link rel="stylesheet" th:href="@{/css/application.css}"/>

    <!-- 2. Tailwind CSS & Config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- üëá TH√äM D√íNG N√ÄY -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
          rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                    }
                }
            }
        }
    </script>

    <!-- 3. Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 4. CSS cho Toast Notification (thay th·∫ø useToast) -->
    <style>
        #toast-notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            z-index: 100;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            visibility: hidden;
        }

        #toast-notification.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .toast-success {
            background-color: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .toast-destructive {
            background-color: hsl(var(--destructive));
            color: hsl(var(--destructive-foreground));
        }
    </style>
    <link rel="stylesheet" th:href="@{/css/home-css.css}"/>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- Header Fragment -->
<div th:replace="~{layout/navbar.html :: header}"></div>

<!-- Main Content -->
<div class="min-h-screen bg-gray-50 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mb-8">
            <h1 class="text-4xl font-bold mb-2">ƒê·∫∑t v√© xem tr·∫≠n ƒë·∫•u</h1>
            <p class="text-gray-600">Ch·ªçn tr·∫≠n ƒë·∫•u v√† s·ªë l∆∞·ª£ng v√© b·∫°n mu·ªën ƒë·∫∑t</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3">

            <!-- 1. Match Selection (Danh s√°ch tr·∫≠n ƒë·∫•u) -->
            <div class="lg:col-span-3 space-y-4">
                <h2 class="text-2xl font-bold mb-4">Ch·ªçn tr·∫≠n ƒë·∫•u</h2>

                <!-- Loop qua c√°c tr·∫≠n ƒë·∫•u (Controller ph·∫£i cung c·∫•p: upcomingMatches) -->
                <div th:each="match : ${upcomingMatches}"
                     th:id="${match.id}"
                     onclick="selectMatch(this)"
                     class="match-card bg-white rounded-lg p-6 cursor-pointer transition-all border-2 border-transparent hover:border-gray-300">

                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2 text-sm text-gray-600">
                            <i data-lucide="calendar" class="w-4 h-4"></i>
                            <span th:text="${#dates.format(match.date, 'dd/MM/yyyy')} + ' - ' + ${match.time}">01/01/2024 - 19:00</span>
                        </div>
                        <span th:if="${match.isImportant}"
                              class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-semibold">
                                QUAN TR·ªåNG
                            </span>
                    </div>
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-lg font-semibold flex-1 text-right" th:text="${match.homeTeam}">Home</div>
                        <div class="text-2xl font-bold text-primary mx-8">VS</div>
                        <div class="text-lg font-semibold flex-1" th:text="${match.awayTeam}">Away</div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-1 text-sm text-gray-600">
                            <i data-lucide="map-pin" class="w-3.5 h-3.5"></i>
                            <span th:text="${match.stadium}">Stadium</span>
                        </div>
                        <div class="text-primary font-bold">300.000ƒë - 1.000.000ƒë</div>
                    </div>
                </div>

                <div th:each=" matchSchedule: ${matchSchedulePage.content}">

                </div>

                <div th:if="${#lists.isEmpty(matchSchedulePage)}" class="text-center text-gray-500 py-10">
                    <p>Kh√¥ng c√≥ tr·∫≠n ƒë·∫•u n√†o s·∫Øp di·ªÖn ra.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div th:each="match : ${matchSchedulePage.content}"
                         class="relative bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden group hover:border-primary/30 transition-all">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-primary/5 to-transparent rounded-bl-full"></div>

                        <div class="p-8">
                            <div class="flex justify-between items-center mb-6">
                                <span class="px-3 py-1 bg-red-50 text-red-600 text-xs font-bold rounded-full border border-red-100">BIG MATCH</span>
                                <div class="flex items-center gap-2 text-gray-500 text-sm font-medium">
                                    <i data-lucide="calendar" class="w-4 h-4"></i>
                                    <span th:text="${#temporals.format(match.matchDate, 'dd/MM')}"></span>

                                    <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                                    <span th:text="${match.matchTime}"></span>
                                </div>
                            </div>

                            <div class="flex items-center justify-between">
                                <!-- Home Team -->
                                <div class="text-center w-1/3">
                                    <div class="w-16 h-16 bg-gray-100 rounded-full mx-auto mb-3 flex items-center justify-center overflow-hidden">
                                        <img th:src="${match.homeTeam.logoUrl}" th:alt="${match.homeTeam.name}"
                                             class="w-full h-full object-cover"/>
                                    </div>
                                    <h3 class="text-lg font-bold text-gray-900 truncate"
                                        th:text="${match.homeTeam.name}">
                                        Home</h3>
                                </div>

                                <!-- Divider -->
                                <div class="w-1/3 text-center">
                                    <div class="text-3xl font-black text-primary">VS</div>
                                    <p class="text-xs text-gray-400 mt-2" th:text="${match.homeTeam.stadium}">
                                        Stadium</p>
                                </div>

                                <!-- Away Team -->
                                <div class="text-center w-1/3">
                                    <div class="w-16 h-16 bg-gray-100 rounded-full mx-auto mb-3 flex items-center justify-center overflow-hidden">
                                        <img th:src="${match.awayTeam.logoUrl}" th:alt="${match.awayTeam.name}"
                                             class="w-full h-full object-cover"/>
                                    </div>
                                    <h3 class="text-lg font-bold text-gray-900 truncate"
                                        th:text="${match.awayTeam.name}">
                                        Away</h3>
                                </div>
                            </div>


                        </div>
                        <div class="bg-gray-50 p-4 border-t border-gray-100 flex justify-center group-hover:bg-primary group-hover:text-white transition-colors cursor-pointer">
                            <a th:href="@{/tickets/create(id=${match.getId()})}"
                               class="font-bold text-sm flex items-center gap-2">ƒê·∫∂T V√â NGAY <i data-lucide="ticket"
                                                                                                class="w-4 h-4"></i></a>
                        </div>
                    </div>
                </div>
                <!-- PAGINATION -->
                <div class="mt-8 flex justify-center" th:if="${totalPages > 1}">
                    <nav class="inline-flex items-center space-x-1" aria-label="Pagination">

                        <!-- V·ªÅ trang ƒë·∫ßu -->
                        <a th:href="@{/ticket(page=0)}"
                           th:classappend="${currentPage == 0} ? ' pointer-events-none opacity-40' : ''"
                           class="px-3 py-1 bg-white border border-gray-300 rounded-l-md text-sm text-gray-700 hover:bg-gray-50">
                            ¬´
                        </a>

                        <!-- Trang tr∆∞·ªõc -->
                        <a th:href="@{/ticket(page=${currentPage - 1})}"
                           th:classappend="${currentPage == 0} ? ' pointer-events-none opacity-40' : ''"
                           class="px-3 py-1 bg-white border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">
                            ‚Äπ
                        </a>

                        <!-- D·∫•u ... tr∆∞·ªõc -->
                        <span th:if="${startPage > 0}"
                              class="px-3 py-1 bg-white border border-gray-300 text-sm text-gray-500">
            ...
        </span>

                        <!-- C√°c s·ªë trang -->
                        <a th:each="i : ${#numbers.sequence(startPage, endPage)}"
                           th:text="${i + 1}"
                           th:href="@{/ticket(page=${i})}"
                           th:classappend="${i == currentPage} ? ' bg-primary text-white border-primary' : ' bg-white text-gray-700 hover:bg-gray-50'"
                           class="px-3 py-1 border border-gray-300 text-sm rounded-md mx-0.5">
                        </a>

                        <!-- D·∫•u ... sau -->
                        <span th:if="${endPage < totalPages - 1}"
                              class="px-3 py-1 bg-white border border-gray-300 text-sm text-gray-500">
            ...
        </span>

                        <!-- Trang sau -->
                        <a th:href="@{/ticket(page=${currentPage + 1})}"
                           th:classappend="${currentPage + 1 >= totalPages} ? ' pointer-events-none opacity-40' : ''"
                           class="px-3 py-1 bg-white border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">
                            ‚Ä∫
                        </a>

                        <!-- Trang cu·ªëi -->
                        <a th:href="@{/ticket(page=${totalPages - 1})}"
                           th:classappend="${currentPage + 1 >= totalPages} ? ' pointer-events-none opacity-40' : ''"
                           class="px-3 py-1 bg-white border border-gray-300 rounded-r-md text-sm text-gray-700 hover:bg-gray-50">
                            ¬ª
                        </a>

                    </nav>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Footer Fragment -->
<div th:replace="~{layout/footer :: footer}"></div>

<!-- Toast Notification HTML -->
<div id="toast-notification">
    <h3 id="toast-title" class="font-bold"></h3>
    <p id="toast-description"></p>
</div>

<!-- Logic JavaScript -->
<script>
    // Kh·ªüi t·∫°o icons
    lucide.createIcons();

    // Bi·∫øn to√†n c·ª•c (Global variable) ƒë·ªÉ l∆∞u tr·∫°ng th√°i
    let selectedMatchId = null;
    let selectedTicketPrice = 300000;
    let selectedTicketCount = 1;

    // H√†m 1: Ch·ªçn tr·∫≠n ƒë·∫•u
    function selectMatch(element) {
        // L·∫•y ID t·ª´ element
        selectedMatchId = element.id;

        // X√≥a style 'active' kh·ªèi t·∫•t c·∫£ c√°c th·∫ª
        const allMatchCards = document.querySelectorAll('.match-card');
        allMatchCards.forEach(card => {
            card.classList.remove('border-2', 'border-primary', 'shadow-lg');
            card.classList.add('border-2', 'border-transparent');
        });

        // Th√™m style 'active' cho th·∫ª ƒë∆∞·ª£c click
        element.classList.add('border-2', 'border-primary', 'shadow-lg');
        element.classList.remove('border-transparent');

        // ·∫®n placeholder, hi·ªán form ƒë·∫∑t v√©
        document.getElementById('booking-placeholder').classList.add('hidden');
        document.getElementById('booking-form').classList.remove('hidden');

        // C·∫≠p nh·∫≠t l·∫°i t√≥m t·∫Øt
        updateSummary();
    }

    // H√†m 2: C·∫≠p nh·∫≠t t√≥m t·∫Øt
    function updateSummary() {
        const countInput = document.getElementById('ticket-count');
        const typeSelect = document.getElementById('ticket-type');

        selectedTicketCount = parseInt(countInput.value) || 1;
        selectedTicketPrice = parseInt(typeSelect.value) || 300000;

        const total = selectedTicketCount * selectedTicketPrice;

        // C·∫≠p nh·∫≠t (Update) UI
        document.getElementById('summary-count').innerText = selectedTicketCount + ' v√©';
        document.getElementById('summary-price').innerText = selectedTicketPrice.toLocaleString('vi-VN') + 'ƒë';
        document.getElementById('summary-total').innerText = total.toLocaleString('vi-VN') + 'ƒë';
    }

    // H√†m 3: X·ª≠ l√Ω ƒë·∫∑t v√©
    function handleBooking() {
        if (!selectedMatchId) {
            showToast("Vui l√≤ng ch·ªçn tr·∫≠n ƒë·∫•u", "B·∫°n c·∫ßn ch·ªçn m·ªôt tr·∫≠n ƒë·∫•u ƒë·ªÉ ƒë·∫∑t v√©", "destructive");
            return;
        }

        // G·ª≠i th√¥ng b√°o th√†nh c√¥ng
        const desc = `B·∫°n ƒë√£ ƒë·∫∑t ${selectedTicketCount} v√© (${(selectedTicketCount * selectedTicketPrice).toLocaleString('vi-VN')}ƒë). Vui l√≤ng ki·ªÉm tra email.`;
        showToast("ƒê·∫∑t v√© th√†nh c√¥ng!", desc, "success");

        // Reset l·∫°i form
        resetBookingForm();
    }

    // H√†m 4: Reset form
    function resetBookingForm() {
        selectedMatchId = null;

        // X√≥a style active
        const allMatchCards = document.querySelectorAll('.match-card');
        allMatchCards.forEach(card => {
            card.classList.remove('border-2', 'border-primary', 'shadow-lg');
            card.classList.add('border-2', 'border-transparent');
        });

        // Reset input
        document.getElementById('ticket-count').value = 1;
        document.getElementById('ticket-type').value = 300000;

        // C·∫≠p nh·∫≠t l·∫°i summary (d√π n√≥ s·∫Ω b·ªã ·∫©n)
        updateSummary();

        // ·∫®n form, hi·ªán placeholder
        document.getElementById('booking-placeholder').classList.remove('hidden');
        document.getElementById('booking-form').classList.add('hidden');
    }

    // H√†m 5: Hi·ªÉn th·ªã Toast (M√¥ ph·ªèng useToast)
    function showToast(title, description, variant = 'success') {
        const toast = document.getElementById('toast-notification');
        const toastTitle = document.getElementById('toast-title');
        const toastDesc = document.getElementById('toast-description');

        // Set n·ªôi dung
        toastTitle.innerText = title;
        toastDesc.innerText = description;

        // Set m√†u s·∫Øc
        toast.className = 'show'; // B·ªè c√°c class m√†u c≈©
        if (variant === 'destructive') {
            toast.classList.add('toast-destructive');
        } else {
            toast.classList.add('toast-success');
        }

        // Hi·ªÉn th·ªã
        toast.classList.add('show');

        // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
        setTimeout(() => {
            toast.classList.remove('show');
        }, 5000);
    }
</script>

</body>
</html>