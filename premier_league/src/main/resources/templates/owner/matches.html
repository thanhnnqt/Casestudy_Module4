<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="layout :: layout('Lịch Thi Đấu', 'matches', ~{::content})">

<th:block th:fragment="content">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    .content-wrapper { font-family: 'Inter', sans-serif !important; }
    .card-custom { border: none; border-radius: 0.75rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); background: #fff; }
    .table-custom thead th { background: #f9fafb; color: #6b7280; font-size: 0.75rem; padding: 1rem; text-transform: uppercase; }
    .table-custom tbody td { padding: 1rem; vertical-align: middle; border-bottom: 1px solid #f3f4f6; font-size: 0.9rem; }
    .badge-soft { padding: 0.35em 0.65em; font-size: 0.75em; font-weight: 600; border-radius: 0.375rem; }
    /* Màu badge */
    .bg-soft-info { background: #eff6ff; color: #2563eb; }
    .bg-soft-success { background: #f0fdf4; color: #16a34a; }
    .bg-soft-danger { background: #fef2f2; color: #dc2626; }
    .bg-soft-warning { background: #fffbeb; color: #d97706; }
    .bg-soft-secondary { background: #f3f4f6; color: #4b5563; }

    .btn-icon { width: 32px; height: 32px; display: inline-flex; align-items: center; justify-content: center; border-radius: 0.375rem; padding: 0; }
  </style>

  <div class="container-fluid">

    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="fw-bold text-dark mb-0"><i class="bi bi-calendar-week text-primary me-2"></i>Lịch Thi Đấu</h2>
    </div>

    <div class="card card-custom mb-4">
      <div class="card-body p-4">
        <form class="row g-3" th:action="@{/admin/matches}" method="get">
          <div class="col-md-4">
            <label class="form-label fw-bold small text-muted">Đội bóng</label>
            <select name="team" class="form-select">
              <option value="">-- Tất cả --</option>
              <option th:if="${teamsList != null}" th:each="t : ${teamsList}"
                      th:value="${t.name}" th:text="${t.name}" th:selected="${team == t.name}">
              </option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label fw-bold small text-muted">Ngày thi đấu</label>
            <input type="date" name="date" class="form-control" th:value="${date}">
          </div>
          <div class="col-md-2">
            <label class="form-label fw-bold small text-muted">Vòng đấu</label>
            <input type="number" name="round" class="form-control" th:value="${round}">
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-dark w-100 fw-bold"><i class="bi bi-search"></i> Tìm kiếm</button>
          </div>
        </form>
      </div>
    </div>

    <div class="card card-custom overflow-hidden">
      <div class="table-responsive">
        <table class="table table-custom table-hover mb-0">
          <thead>
          <tr>
            <th class="text-center">STT</th>
            <th>Trận đấu</th>
            <th class="text-center">Vòng</th>
            <th>Thời gian</th>
            <th>Sân vận động</th> <th class="text-center">Trạng thái</th>
            <th class="text-end">Hành động</th>
          </tr>
          </thead>

          <tbody>
          <tr th:if="${matches == null or #lists.isEmpty(matches)}">
            <td colspan="7" class="text-center py-5 text-muted">
              <i class="bi bi-inbox display-4 d-block mb-3"></i>
              Không có dữ liệu trận đấu.
            </td>
          </tr>

          <tr th:each="match, iterStat : ${matches}">
            <td class="text-center fw-bold text-muted" th:text="${iterStat.count}"></td>

            <td>
              <div class="d-flex align-items-center">
                <span class="fw-bold text-primary"
                      th:text="${match.homeTeam != null ? match.homeTeam.name : 'Unknown'}"></span>
                <span class="badge bg-light text-muted border mx-2">VS</span>
                <span class="fw-bold text-primary"
                      th:text="${match.awayTeam != null ? match.awayTeam.name : 'Unknown'}"></span>
              </div>
              <div class="small mt-1 fw-bold text-dark"
                   th:if="${match.homeScore != null}"
                   th:text="${match.homeScore} + ' - ' + ${match.awayScore}">
              </div>
            </td>

            <td class="text-center">
              <span class="badge bg-light text-dark border"
                    th:text="${match.round != null ? '#' + match.round : '-'}"></span>
            </td>

            <td>
              <div class="d-flex flex-column" th:if="${match.matchDate != null}">
                <span class="fw-bold text-dark" th:text="${#temporals.format(match.matchDate, 'dd/MM/yyyy')}"></span>
                <span class="small text-muted">
                   <i class="bi bi-clock me-1"></i><span th:text="${#temporals.format(match.matchDate, 'HH:mm')}"></span>
                </span>
              </div>
            </td>

            <td class="text-muted small" th:text="${match.stadium != null ? match.stadium : ''}"></td>

            <td class="text-center">
              <span th:if="${match.status != null}" th:switch="${match.status.name()}">
                  <span th:case="'UPCOMING'" class="badge badge-soft bg-soft-info">Lịch đấu</span>
                  <span th:case="'SCHEDULED'" class="badge badge-soft bg-soft-success">Sắp đá</span>
                  <span th:case="'LIVE'" class="badge badge-soft bg-soft-danger">Live</span>
                  <span th:case="'POSTPONED'" class="badge badge-soft bg-soft-warning">Hoãn</span>
                  <span th:case="'FINISHED'" class="badge badge-soft bg-soft-secondary">Kết thúc</span>
              </span>
            </td>

            <td class="text-end">
              <div class="d-flex justify-content-end gap-1" th:if="${match.status != null}">
                <th:block th:if="${match.status.name() == 'UPCOMING' or match.status.name() == 'SCHEDULED'}">
                  <a th:href="@{'/admin/matches/start/' + ${match.id}}" class="btn btn-icon btn-outline-success" title="Bắt đầu"><i class="bi bi-play-fill"></i></a>
                </th:block>

                <th:block th:if="${match.status.name() == 'LIVE'}">
                  <a th:href="@{'/admin/matches/live/' + ${match.id}}" class="btn btn-icon btn-outline-danger" title="Xem"><i class="bi bi-eye"></i></a>
                </th:block>

                <a href="#" class="btn btn-icon btn-light text-muted"><i class="bi bi-pencil-square"></i></a>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="card-footer bg-white border-top-0 py-3" th:if="${totalPages != null and totalPages > 1}">
        <nav>
          <ul class="pagination justify-content-center mb-0">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
              <a class="page-link rounded-pill px-3" th:href="@{/admin/matches(page=${currentPage - 1}, team=${team})}">&laquo;</a>
            </li>
            <li class="page-item disabled"><span class="page-link border-0">Trang <span th:text="${currentPage + 1}"></span></span></li>
            <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
              <a class="page-link rounded-pill px-3" th:href="@{/admin/matches(page=${currentPage + 1}, team=${team})}">&raquo;</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function(){
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'))
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
      })
    });
  </script>

</th:block>
</html>